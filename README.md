# Contents
This repository contains all tools and their sources relevant in the paper

  "Ranking and Repulsing Supermartingales for Reachability in Randomized Programs", 

which is currently under review.

# How to reproduce the experimental result
The following procedure is checked on Cygwin 3.1.2-1 over Windows 10 with 
OCaml 4.08.0,
GLPK v4.65,
matlab 9.7.0.1296695 (R2019b) Update 4 and 
SOSTOOLS v3.03.


1. Download the repository and put it to any directory
2. Open `$yourRoot/scripts/env.sh` and change the description of myRoot and myRootMatlab to the root of the repository
3. Open terminal, do `cd $yourRoot/scripts` and `./make.sh` to compile the codes
4. Run `./generate_table.sh all` to reproduce experimental results

# Files
- `README.md`  ... this file
- `COPYING.txt` ... a copy of GNU General Public License (see License section below)
- `models/PP`  ... the benchmark set called by the main code
- `code`       ... the main code that generate optimization problems for martingale synthesis
- `scripts`    ... scripts that conduct experiments

When you run the script `generate_table.sh`, the following files will be created:

- `models/solverReady` ... optimization problem files (.mod, .m) generated by the main code
- `outputFiles`        ... results and logs generated by optimization solvers


# The code
Each of the directory `mycode/$SM_NAME` contains the code that translates probabilistic programs (.pp files in `models/PP`) into optimization problem files (.mod, .m files in `models/solverReady`), which can be then solved by optimization solvers. See `mycode/how_to_use_the_code.txt` for the usage.

A file in `mycode/matlab` is a modification of `sossolve.m` in SOSTOOLS.


# The scripts
In the folder `scripts` there are following shell-scripts and a folder. See also the comment in each script.

- `env.sh`                ... it contains the root directory information used in other scripts.
- `make.sh`               ... it runs `make` for each code in the `code` directory.
- `generate_inputs.sh`    ... it performs a batch execution of .pp file translation by the main code (in `code`) with parameters in `scripts/parameters`. This script, `run_benchmarks.sh`, `read_logs.sh` and `eRepSupM_heuristics.sh` need a parameter file for its execution (e.g. you can run `./run_benchmarks.sh delta_ex1_lin` to generate synthesis problems for U-NNRepSupM in Table 2 of the paper).
- `run_benchmarks.sh`    ... it performs a batch execution of an optimization solver. Inputs should be generated by `generate_inputs.sh` prior execution.
- `read_logs.sh`         ... it reads the log files generated by an optimization solver and produces a table of results in `outputFiles`.
- `eRepSupM_heuristics.sh` ... it performs the heuristics synthesis algorithm of epsilon-repulsing supermartingale proposed in [Chatterjee+, POPL2017]. This script generates .pp file translation by itself, so you do not need to run `generate_inputs.sh` prior execution.
- `generate_table.sh` ... it executes `rgenerate_inputs.sh`, `run_benchmarks.sh` and `read_logs.sh` sequentially with parameters in `scripts/parameters`. One can also run `generate_table.sh all` to reproduce all experimental result by linear template-based synthesis (including epsilonRepSupM synthesis via `eRepSupM_heuristics.sh`).
- `translate.sh`           ... a script called by `generate_inputs.sh`.
- `parameters`             ... it contains parameter files for other scripts.


# The log files
The log directory `outputFiles` is created when you execute the script `run_benchmarks.sh`.
The log file `$MODELNAME.log` of the optimization is put there.


# The Tables 
A summary of the experiment is generated in the `tables` folder. 
- for NNRepSupM and GammaSclSubM, a table is generated for each parameter file (e.g. `delta_ex1_lin`). 
  In the paper, the value in the "Bound" and "Time - real" columns are reported as the bound and computation time, respectively (except for `delta_ex1_lin`, where we report [1 - Bound] as the bound).
- for EpsilonRepSupM (via `eRepSupM_heuristics.sh`), a table is generated for each model, and 
  the result of every itration is provided there (`eRepSupM_heuristics.sh` iteratively performs EpsilonRepSupM synthesis for different kappa's). 
  The "Obj" column reports the value of synthesized martingale at the initial state; and the "Bound" column reports the bound of reachability probability. 
  In the paper, the smallest value in the "Bound" column is reported as the bound; and the sum of the "Time - real" column is reported as the computation time.


# Licence
The content of this repository is freely available under the GNU General Public License (GPL) version 2.
A copy of this license can be found in the file COPYING.txt.
For more information, see:

  http://www.gnu.org/licenses/



# References 
[Chatterjee+, POPL2017] Chatterjee, K., Novotný, P., Zikelic, D.: Stochastic invariants for probabilistic termination. In: Castagna, G., Gordon, A.D. (eds.) Proc. of POPL 2017. pp. 145–160. ACM (2017)

